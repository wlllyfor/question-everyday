æœ¬é¢˜éš¾åº¦ï¼šâ­ â­ 

ä¸€èˆ¬è¿™é“é¢˜çš„é—®æ³•æ˜¯ï¼šé—­åŒ…æœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯ï¼Ÿ

ç­”ï¼š

é—­åŒ…æœ‰ä¸€ä¸ªåº”ç”¨åœºæ™¯å°±æ˜¯å¤§é‡åº”ç”¨äºç±»åº“å°è£…ä¸­ã€‚

ç±»åº“å°è£…æœ€é‡è¦çš„è¦æ±‚å°±æ˜¯ä¸èƒ½è®©ç±»åº“ä¸­çš„å˜é‡æ±¡æŸ“å…¨å±€ã€‚

ä¸¾ä¸ªä¾‹å­ï¼ŒjQuery å†…éƒ¨å®ç°æ˜¯éå¸¸å¤æ‚çš„ï¼Œä½†å®ƒæš´éœ²ç»™å…¨å±€çš„ä»…ä»…å°±æ˜¯ä¸€ä¸ª `$` è€Œå·²ï¼Œå†…éƒ¨ä¸ºäº†å®ç°jQuery å®šä¹‰çš„ä¸€å¤§å †å˜é‡ä¸ä¼šæ±¡æŸ“å…¨å±€ã€‚

å®ƒæ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿå…¶å®å°±æ˜¯ç”¨çš„é—­åŒ…ï¼Œæˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸‹ï¼Œå°±æ˜¯ç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š

```js
(function () {
  // å®ç° jQueryï¼Œå†…éƒ¨ä¸€å¤§å †ä»£ç ï¼Œå®šä¹‰äº†ä¸€å¤§å †å˜é‡
  let a = 'xxx'
  let b = 'xxx'
  let c = 'xxx'
  // æŠŠ $ æŒ‚è½½åˆ° window ä¸Šï¼Œåªæš´éœ² $ æ–¹æ³•
  var jQuery = window.$ = function() {
    // jQuery.xxx å¤–éƒ¨ç”¨ $ï¼Œå†…éƒ¨ç”¨ jQuery è¿™ä¸ªå˜é‡
    // ...
  }
})()

$('#div').hide()
```

è¿™ç§å†™æ³•ä¹Ÿå¯ä»¥ï¼š

```js
var $ = (function() {
  function jQuery() {
    // ...
  }
  return jQuery
})()

$('#div').hide()
```

äº‹å®ä¸Šï¼ŒjQuery çš„æºç é•¿è¿™æ ·å­ï¼Œè·Ÿæˆ‘ä»¬ä¸Šæ–‡åˆ†æçš„å†™æ³•å·®ä¸å¤šï¼Œå°±æ˜¯ç”¨åˆ°çš„é—­åŒ…ï¼Œéƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š
```js
;(function (global, factory) {...
})(typeof window !== 'undefined' ? window : this, function (window, noGlobal) {...
    
    // ...
    jQuery = function (selector, context) {
      return new jQuery.fn.init(selector, context)
    }
    // ...
    var init = (jQuery.fn.init = function (selector, context, root) {
      // ...
    })
    // ...
    
    window.jQuery = window.$ = jQuery
    return jQuery
})
```

## æ‰©å±•ï¼šæ‰‹å†™ä¸€ä¸ªè¿·ä½  jQueryï¼Œç”¨ Rollup æ‰“åŒ…

è™½ç„¶ç°åœ¨é™¤äº†å†™å®˜ç½‘ç­‰éœ€æ±‚ï¼Œå¾ˆå°‘ä½¿ç”¨ jQuery äº†ï¼Œä½†æ˜¯ jQuery ä½œä¸ºå‰ç«¯åˆ€è€•ç«ç§æ—¶ä»£ç¬¬ä¸€ä¸ªæ­£å¼æ„ä¹‰çš„å‰ç«¯æ¡†æ¶ï¼Œå½“å¹´ç»™å‰ç«¯å¸¦æ¥çš„æ•ˆç‡æå‡ï¼Œå…·æœ‰éå‡¡çš„æ„ä¹‰ã€‚

é˜¿æ—ä½œä¸ºæ–°ç”Ÿä»£çš„å°å‰ç«¯ï¼Œè‡ªå·¥ä½œä»¥æ¥ï¼Œä»æ²¡å†™è¿‡ jQueryï¼Œè¿™æ¬¡ä¸ºäº†å­¦ä¹ é—­åŒ…å»çœ‹äº† jQuery çš„æºç ï¼Œè¿™ä¸€çœ‹å°±æ·±æ·±é™·å…¥å…¶ä¸­ï¼ŒçœŸçš„è®¾è®¡å¾—éå¸¸å·§å¦™ï¼Œä¸å¾—ä¸ä½©æœå‰äººçš„æ™ºæ…§ã€‚

é˜¿æ—å°±æ¥æ‰‹å†™ä¸€ä¸ªç©¶æè¿·ä½ çš„ jQueryï¼Œå®ç°å‡ ä¸ªå°åŠŸèƒ½ã€‚

- $ å‡½æ•°ï¼Œæ”¯æŒä¼ å…¥é€‰æ‹©å™¨å’Œå‡½æ•°ã€‚
- å®ç° htmlã€addClassã€onã€valã€append æ–¹æ³•ã€‚

å½“ç„¶ï¼Œç°åœ¨æ˜¯ç”¨ class æ¥å®ç°çš„ï¼Œå’Œä»¥å‰ç”¨ function çš„æ€æƒ³æ˜¯å·®ä¸å¤šçš„ã€‚

åˆ›å»ºä¸€ä¸ª test ç›®å½•ï¼ŒæŠŠè¿·ä½  jQuery çš„é€»è¾‘å†™åˆ° src ç›®å½•ä¸‹çš„ jQuery.js é‡Œ

```js
// src/jQuery.js
export default function (selector) {
  return new JQuery(selector)
}

class JQuery {
  constructor (selector) {
    this.selector = selector
    this.init(selector)
  }

  init (selector) {
    if (typeof selector === 'string') {
      this.elements = [...document.querySelectorAll(selector)]
    } else if (typeof selector === 'function') {
      this.elements = []
      document.addEventListener('DOMContentLoaded', selector)
    }
  }

  html (str) {
    if (str !== undefined) {
      this.elements.forEach(ele => {
        ele.innerHTML = str
      })
      return this
    } else {
      return this.elements[0].innerHTML
    }
  }

  addClass (className) {
    this.elements.forEach(ele => {
      ele.classList.add(className)
    })
    return this
  }

  on (event, callback, useCapture = false) {
    this.elements.forEach(ele => {
      ele.addEventListener(event, callback, useCapture)
    })
    return this
  }

  val (str) {
    if (str !== undefined) {
      this.elements.forEach(ele => {
        ele.value = str
      })
      return this
    } else {
      return this.elements[0].value
    }
  }

  append (child) {
    if (typeof child === 'string') {
      this.elements.forEach(ele => {
        ele.innerHTML += child
      })
    }
  }
}
```

ç»ˆç«¯è¿›å…¥è¿™ä¸ª test ç›®å½•ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š

```code
npx rollup -f iife -n $ -o ./dist/jQuery.js  ./src/jQuery.js
```

è§£é‡Šä¸€ä¸‹è¿™äº› rollup å‘½ä»¤

-   -f æŒ‡å®šiifeæ–¹å¼è¾“å‡º
-   -o æŒ‡å®šè¾“å‡ºæ–‡ä»¶
-   -n æŒ‡å®šè¾“å‡ºå˜é‡å

è¿™æ ·å°±å¯ä»¥æ‰“åŒ…ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°æ¨¡å¼çš„è¿·ä½  jQueryï¼Œç”Ÿæˆåˆ°äº† dist ç›®å½•çš„ jQuery.js ä¸‹

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/19ff9d660b634319a50da9bb3ef8dca8~tplv-k3u1fbpfcp-watermark.image?)

æ‰“åŒ…å‡ºæ¥çš„ä»£ç å…¶å®é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°æŠŠæˆ‘ä»¬å†™åˆ°ä»£ç åŒ…èµ·æ¥ï¼Œå¯¹å¤–æš´éœ²ä¸€ä¸ª $ å‡½æ•°ï¼š

```js
var $ = (function () {
  'use strict';

  function jQuery (selector) {
    return new JQuery(selector)
  }

  class JQuery {... // è¿™é‡Œå°±æ˜¯æˆ‘ä»¬ä¸Šé¢å†™çš„é€»è¾‘ï¼ŒæŠ˜å èµ·æ¥
  }

  return jQuery;

})();
```


ç„¶åå°±å¯ä»¥åœ¨ä¸šåŠ¡ä»£ç ä¸­å¼•ç”¨æ‰“åŒ…ç”Ÿæˆçš„`dist/jQuery.js`ï¼Œç”¨ jQuery ä¸€æŠŠæ¢­é¡µé¢äº†ã€‚

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <style>
    .text-red {
      color: red;
    }
  </style>
  <script src="./dist/jQuery.js"></script>
  <script>
    $(function() {
      $('#title').html('qwe').addClass('text-red')

      $('#btn').on('click', function() {
        let val = $('#input').val()
        $('#ul').append(`<li>${val}</li>`)
        $('#input').val('')
      })

    })
  </script>
</head>
<body>
  <h1 id="title">hello world</h1>
  <input id="input" type="text">
  <button id="btn">æ·»åŠ </button>
  <ul id="ul">

  </ul>
</body>
</html>
```

**ç»“å°¾**

æœ¬æ–‡å‚è€ƒè‡ªè¿™ç¯‡æ–‡ç« ï¼š

[Day12 - é—­åŒ…åº”ç”¨4 - ç±»åº“å°è£…](https://juejin.cn/post/7052238635671748616)

æ„Ÿè°¢ç„¶å”ï¼Œè®©æˆ‘å¯¹é—­åŒ…çš„ç†è§£æ›´è¿›ä¸€æ­¥ï¼Œé˜¿æ—æœ€è¿‘å­¦ä¹ é—­åŒ…å†™çš„æ–‡ç« å¤§éƒ½å‚è€ƒè‡ªç„¶å”çš„æ–‡ç« ï¼Œç„¶å”ç‰›ï¼

[å…¨æ ˆç„¶å”çš„ä¸»é¡µ](https://juejin.cn/user/1978776660216136/posts)

å¦‚æœæˆ‘çš„æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä½ çš„ğŸ‘å°±æ˜¯å¯¹æˆ‘çš„æœ€å¤§æ”¯æŒ^_^

ä½ ä¹Ÿå¯ä»¥å…³æ³¨ã€Šå‰ç«¯æ¯æ—¥ä¸€é—®ã€‹è¿™ä¸ªä¸“æ ï¼Œé˜²æ­¢å¤±è”å“¦ï½

æˆ‘æ˜¯é˜¿æ—ï¼Œè¾“å‡ºæ´è§æŠ€æœ¯ï¼Œå†ä¼šï¼

ä¸Šä¸€ç¯‡ï¼š

[ã€Œå‰ç«¯æ¯æ—¥ä¸€é—®ï¼ˆ35ï¼‰ã€webpack æ¨¡å—åŒ–æ‰“åŒ…æ˜¯å¦‚ä½•ç”¨é—­åŒ…å®ç°çš„ï¼Ÿ](https://github.com/wlllyfor/question-everyday/blob/main/Blog/35.webpack%20%E6%A8%A1%E5%9D%97%E5%8C%96%E6%89%93%E5%8C%85%E6%98%AF%E5%A6%82%E4%BD%95%E7%94%A8%E9%97%AD%E5%8C%85%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%9F.md)

ä¸‹ä¸€ç¯‡ï¼š

[ã€Œå‰ç«¯æ¯æ—¥ä¸€é—®ï¼ˆ37ï¼‰ã€callã€apply å’Œ bind çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ](https://juejin.cn/post/7081066766578745374)