æœ¬é¢˜éš¾åº¦ï¼šâ­ â­ â­ 

ç­”ï¼š

**é¢è¯•è¿‡å…³ç‰ˆæœ¬**

```js
Function.prototype.myCall = function (context = window) {
  context.fn = this 
  const args = [...arguments].slice(1) 
  const res = context.fn(...args) 
  delete context.fn 
  return res 
}
```

**å°½å¯èƒ½å®Œå–„çš„ç‰ˆæœ¬**

```js
Function.prototype.myCall = function (context) {
  if (context === null || context === undefined) {
      context = window 
  } else {
      context = Object(context) 
  }
  const fn = Symbol('fn') 
  context[fn] = this 
  const args = [...arguments].slice(1) 
  let result = context[fn](...args) 
  delete context[fn]
  return result
}
```

è¦è¯»æ‡‚æœ¬æ–‡ï¼Œéœ€æŒæ¡ä¸‹é¢çš„å‰ç½®çŸ¥è¯†ï¼š

- [this æŒ‡å‘é—®é¢˜](https://juejin.cn/post/7076952442151108644)
- [argumentsï¼Œä¼ªæ•°ç»„è½¬æ•°ç»„](https://juejin.cn/post/7074719051057987614)
- [slice](https://juejin.cn/post/7073646349631094814#heading-4)
- [å¯¹è±¡ delete æ“ä½œç¬¦](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/delete)
- [symbol](https://juejin.cn/post/7069168967897579551)

## ä¸€æ­¥ä¸€æ­¥å®ç°æ‰‹å†™ call

åœ¨æ‰‹å†™ä¹‹å‰ï¼Œå…ˆæ˜ç™½ call å‡½æ•°çš„åŠŸèƒ½ï¼Œæ˜¯ä¸ºäº†æ”¹å˜ this çš„æŒ‡å‘ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š

```js
var lastName = 'xxx'
const person = {
  lastName: 'lin'
}

function fn () {
  console.log(this.lastName)
}

fn.call(person) // ç”¨call this æŒ‡å‘ personï¼Œè¾“å‡º 'lin'
fn.call() // ç›´æ¥è°ƒç”¨ï¼ŒthisæŒ‡å‘ windowï¼Œè¾“å‡º 'xxx'
```
### å®ç° this çš„æ˜¾å¼æŒ‡å‘

call æ˜¯å†™åˆ° Function.prototype ä¸Šçš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ª myCallï¼Œä¹Ÿå†™åˆ°åŸå‹é“¾ä¸Šã€‚

```js
Function.prototype.myCall = function(obj) {
  obj.fn = this // è¿™é‡Œçš„ this å°±æ˜¯è°ƒç”¨ myCall çš„å‡½æ•°ï¼ŒæŠŠå‡½æ•°èµ‹å€¼ç»™ obj.fnï¼Œè¿™æ ·æ‰§è¡Œ obj.fn() æ—¶ï¼Œå‡½æ•°å†…çš„ this å°±æŒ‡å‘äº† obj
  obj.fn() // æ‰§è¡Œ objä¸Šé¢çš„ fn æ–¹æ³•
  delete obj.fn // æ‰§è¡Œå®Œäº†ï¼Œfn æ–¹æ³•å°±æ²¡ç”¨äº†ï¼Œåˆ é™¤æ‰ 
}
```

æµ‹è¯•ä¸€ä¸‹ï¼š

```js
var lastName = 'xxx'
const person = {
  lastName: 'lin'
}

function fn () {
  console.log(this.lastName)
}

fn.myCall(person) // è¾“å‡º 'lin'
fn.myCall(window) // è¾“å‡º 'xxx'
```

è¿™æ ·å°±å®ç°äº† this æ˜¾å¼æŒ‡å‘ä¼ å…¥çš„å¯¹è±¡ã€‚

### å…¼å®¹ä¸ä¼ å€¼çš„æƒ…å†µ

ä½†æ˜¯ç°åœ¨è¿˜æœ‰é—®é¢˜ï¼Œä¸ä¼ å…¥è¦æŒ‡å‘çš„å¯¹è±¡çš„è¯ä¼šæŠ¥é”™ï¼š

```js
fn.myCall() // Uncaught TypeError: Cannot set properties of undefined (setting 'fn')
```

æˆ‘ä»¬æ”¹é€ ä¸€ä¸‹ myCallï¼Œå…¼å®¹ä¸ä¼ å…¥ä¸Šä¸‹æ–‡çš„æƒ…å†µï¼Œä¸Šä¸‹æ–‡ä¸ä¼ å…¥å°±é»˜è®¤æŒ‡å‘ windowï¼Œé¡ºä¾¿æ”¹ä¸€ä¸‹å‚æ•°åå­—ï¼Œä¸å« objï¼Œå« context æ›´åˆé€‚ä¸€ç‚¹ï¼š

```js
Function.prototype.myCall = function(context = window) {
  context.fn = this 
  context.fn() 
  delete context.fn 
}
```
æµ‹è¯•ä¸€ä¸‹ï¼š
```js
var lastName = 'xxx'
function fn () {
  console.log(this.lastName)
}

fn.myCall() // 'xxx'
```
è¿™æ ·å°±å…¼å®¹äº†ä¸ä¼ å€¼çš„æƒ…å†µã€‚

### å®ç°å‚æ•°ä¼ é€’

ä½†æ˜¯ç°åœ¨è¿˜æœ‰é—®é¢˜ï¼Œå‚æ•°æ²¡æœ‰æºå¸¦è¿›å»ï¼Œæ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼Œarguments æ˜¯ç©ºçš„ã€‚

```js
const person = {
  lastName: 'lin'
}

function fn () {
  console.log('this.lastName :>> ', this.lastName)
  console.log('[...arguments] :>> ', [...arguments])
}

fn.myCall(person, 1, 2, 3, 4)
```

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ccc7ce9072842d8ab24c74ef38a5684~tplv-k3u1fbpfcp-watermark.image?)

æˆ‘ä»¬æ”¹é€ ä¸€ä¸‹ï¼Œæ‰§è¡Œ fn å‡½æ•°æ—¶æŠŠå‚æ•°æºå¸¦è¿›å»ã€‚

```js
Function.prototype.myCall = function(context = window) {
  context.fn = this 
  const args = [...arguments].slice(1) // è·å–é™¤äº†ç¬¬ä¸€ä¸ªå‚æ•°ä¹‹å¤–åé¢çš„æ‰€æœ‰å‚æ•°
  context.fn(...args) // æ‰§è¡Œçš„æ—¶å€™æŠŠå‚æ•°ä¼ é€’è¿›å»
  delete context.fn 
}
```

è¿˜æ˜¯åˆšæ‰çš„ä»£ç ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d7c63ce633b4ae79aee16449ff7fd2b~tplv-k3u1fbpfcp-watermark.image?)

### è·å–è¿”å›å€¼

ä½†æ˜¯ç°åœ¨è¿˜æœ‰é—®é¢˜ï¼Œæ‰§è¡Œè¿™ä¸ªå‡½æ•°æ—¶çš„è¿”å›å€¼æ²¡æœ‰è¿”å›ï¼Œæ¯”å¦‚è¿”å›æ‰€æœ‰å‚æ•°ç›¸åŠ çš„å’Œï¼Œç»“æœæ˜¯ undefiendã€‚
```js
function fn () {
  return [...arguments].reduce((acc, cur) => acc + cur)
}

console.log(fn.myCall(person, 1, 2, 3, 4)) // undefined
```

ç»§ç»­æ”¹é€  myCall å‡½æ•°ï¼Œ

```js
Function.prototype.myCall = function(context = window) {
  context.fn = this 
  const args = [...arguments].slice(1)
  const res = context.fn(...args) // ç”¨ä¸€ä¸ªå˜é‡ res æ¥æ¥æ”¶å‡½æ•°è¿”å›å€¼
  delete context.fn 
  return res // è¿”å› res
}
```
æµ‹è¯•ä¸€ä¸‹ï¼š

```js
function fn () {
  return [...arguments].reduce((acc, cur) => acc + cur)
}

console.log(fn.myCall(person, 1, 2, 3, 4)) // 10
```

è‡³æ­¤ï¼Œä¸€ä¸ªé¢è¯•è¿‡å…³ç‰ˆæœ¬çš„æ‰‹å†™ call å‡½æ•°ï¼Œå°±å®ç°å®Œäº†ã€‚

## æ‹“å±•ï¼šå°½å¯èƒ½å®Œå–„çš„ç‰ˆæœ¬

å°½å¯èƒ½å®Œå–„çš„ç‰ˆæœ¬ï¼Œæƒ³åŠæ³•è§£å†³ä¸€äº›è¾¹ç¼˜æƒ…å†µã€‚

### å…¼å®¹åŸå§‹ç±»å‹


ä»€ä¹ˆæ˜¯è¾¹ç¼˜æƒ…å†µï¼Œæ¯”å¦‚ï¼ŒæŠŠè¦æŒ‡å‘çš„å¯¹è±¡æŒ‡å‘ä¸€ä¸ªåŸå§‹å€¼ï¼Œå°±æŠ¥é”™äº†ï¼š

```js
fn.myCall(0)
```

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8078956c45a64c56a2739c81d289ff4d~tplv-k3u1fbpfcp-watermark.image?)

è¿™æ—¶ï¼Œå°±éœ€è¦å‚è€ƒä¸€ä¸‹åŸç”Ÿçš„ call å‡½æ•°æ˜¯å¦‚ä½•è§£å†³äº†çš„ï¼Œæˆ‘ä»¬æ‰“å°å‡ºæ¥çœ‹ä¸€ä¸‹ï¼š

```js
var lastName = 'xxx'
const person = {
  lastName: 'lin'
}

function fn (type) {
  console.log(type, '->', this.lastName)
}


fn.call(0, 'number')
fn.call(1n, 'bigint')
fn.call(false, 'boolean')
fn.call('123', 'string')
fn.call(undefined, 'undefined')
fn.call(null, 'null')
const a = Symbol('a')
fn.call(a, 'symbol')
fn.call([], 'å¼•ç”¨ç±»å‹')
```

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/74e7a2d24b854cf8b43686f562485c28~tplv-k3u1fbpfcp-watermark.image?)

å¯ä»¥çœ‹åˆ°ï¼Œundefined å’Œ null æŒ‡å‘äº† windowï¼ŒåŸå§‹ç±»å‹å’Œå¼•ç”¨ç±»å‹éƒ½æ˜¯ undefinedã€‚

å…¶å®æ˜¯å› ä¸ºï¼ŒåŸå§‹ç±»å‹æŒ‡å‘å¯¹åº”çš„åŒ…è£…ç±»å‹ï¼Œå¼•ç”¨ç±»å‹å°±æŒ‡å‘è¿™ä¸ªå¼•ç”¨ç±»å‹ï¼Œä¹‹æ‰€ä»¥è¾“å‡ºå€¼éƒ½æ˜¯ undefinedï¼Œæ˜¯å› ä¸ºè¿™äº›å¯¹è±¡ä¸Šéƒ½æ²¡æœ‰ lastName å±æ€§ã€‚

æ”¹é€ ä¸€ä¸‹æˆ‘ä»¬çš„ myCall å‡½æ•°ï¼Œå®ç°åŸå§‹ç±»å‹çš„å…¼å®¹ï¼š

```js
Function.prototype.myCall = function (context = window) {
  if (context === null || context === undefined) { 
    context = window // undefined å’Œ null æŒ‡å‘ window
  } else {
    context = Object(context) // åŸå§‹ç±»å‹å°±åŒ…è£…ä¸€ä¸‹
  }
  context.fn = this 
  const args = [...arguments].slice(1) 
  const res = context.fn(...args) 
  delete context.fn 
  return res 
}
```

### symbol å¤„ç†å¯¹è±¡çš„å±æ€§ï¼Œé˜²æ­¢å±æ€§é‡å

å‡è®¾å¯¹è±¡ä¸Šæœ¬æ¥å°±æœ‰ä¸€ä¸ª fn å±æ€§ï¼Œæ‰§è¡Œä¸‹é¢çš„è°ƒç”¨ï¼Œå¯¹è±¡ä¸Šçš„ fn å±æ€§ä¼šè¢«åˆ é™¤ã€‚

```js
const person = {
  lastName: 'lin',
  fn: 123
}

function fn () {
  console.log(this.lastName)
}

fn.myCall(person)

console.log('person :>> ', person);
```

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/49fb0a94b250440f985e34740107fbde~tplv-k3u1fbpfcp-watermark.image?)

å› ä¸ºå¯¹è±¡ä¸Šæœ¬æ¥çš„ fn å±æ€§å’Œ myCall å‡½æ•°å†…éƒ¨ä¸´æ—¶å®šä¹‰çš„fn å±æ€§é‡åäº†ã€‚

å¯ä»¥ç”¨ symbol æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œç»§ç»­æ”¹é€  myCall å‡½æ•°ã€‚

```js
Function.prototype.myCall = function (context = window) {
  if (context === null || context === undefined) {
    context = window
  } else {
    context = Object(context)
  }
  const fn = Symbol('fn') // ç”¨ symbol å¤„ç†ä¸€ä¸‹
  context[fn] = this 
  const args = [...arguments].slice(1) 
  const res = context[fn](...args) 
  delete context[fn] 
  return res 
}
```
è¿™æ ·åœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œfn å°±ä¸ä¼šå› ä¸ºé‡åè¢«è¦†ç›–äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/138d0d93e5f3403eaf6f2ef0a36207d5~tplv-k3u1fbpfcp-watermark.image?)

è‡³æ­¤ï¼Œä¸€ä¸ªå°½å¯èƒ½å®Œå–„ç‰ˆæœ¬çš„ myCall ï¼Œç»ˆäºå†™å®Œäº†ã€‚

å…¶å®ç”¨ Math.random() æ¥ç”Ÿæˆä¸€ä¸ªéšæœºçš„å±æ€§ï¼Œä¹Ÿå¯ä»¥è§£å†³å±æ€§é‡åé—®é¢˜ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚

**ç»“å°¾**

é˜¿æ—æ°´å¹³æœ‰é™ï¼Œæ–‡ä¸­å¦‚æœæœ‰é”™è¯¯æˆ–è¡¨è¾¾ä¸å½“çš„åœ°æ–¹ï¼Œéå¸¸æ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡å‡ºï¼Œæ„Ÿè°¢ï½

å¦‚æœæˆ‘çš„æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä½ çš„ğŸ‘å°±æ˜¯å¯¹æˆ‘çš„æœ€å¤§æ”¯æŒ^_^

ä½ ä¹Ÿå¯ä»¥å…³æ³¨ã€Šå‰ç«¯æ¯æ—¥ä¸€é—®ã€‹è¿™ä¸ªä¸“æ ï¼Œé˜²æ­¢å¤±è”å“¦ï½

æˆ‘æ˜¯é˜¿æ—ï¼Œè¾“å‡ºæ´è§æŠ€æœ¯ï¼Œå†ä¼šï¼

ä¸Šä¸€ç¯‡ï¼š

[ã€Œå‰ç«¯æ¯æ—¥ä¸€é—®ï¼ˆ38ï¼‰ã€åˆ—ä¸¾ä¸€äº›callã€applyã€bind çš„ä½¿ç”¨åœºæ™¯](https://github.com/wlllyfor/question-everyday/blob/main/Blog/38.%E5%88%97%E4%B8%BE%E4%B8%80%E4%BA%9Bcall%E3%80%81apply%E3%80%81bind%20%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF.md)

ä¸‹ä¸€ç¯‡ï¼š

[ã€Œå‰ç«¯æ¯æ—¥ä¸€é—®ï¼ˆ40ï¼‰ã€æ‰‹å†™ apply å‡½æ•°](https://github.com/wlllyfor/question-everyday/blob/main/Blog/40.%E6%89%8B%E5%86%99%20apply%20%E5%87%BD%E6%95%B0.md)